{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Agent Treasury Policy",
  "type": "object",
  "required": ["meta", "caps", "calls", "approvals", "controls"],
  "properties": {
    "meta": {
      "type": "object",
      "required": ["denomination", "logging"],
      "properties": {
        "denomination": { "type": "string", "enum": ["BASE_USDC", "ETH"] },
        "logging": { "type": "boolean" }
      }
    },
    "caps": {
      "type": "object",
      "required": ["max_outflow_h1", "max_outflow_d1", "call_rate_cap"],
      "properties": {
        "max_outflow_h1": { "type": "number", "exclusiveMinimum": 0 },
        "max_outflow_d1": { "type": "number", "exclusiveMinimum": 0 },
        "call_rate_cap": { "type": "string", "pattern": "^[0-9]+/hour$" },
        "anomaly_block": { "type": "object", "properties": { "enabled": { "type": "boolean" } } },
        "per_function": {
          "type": "object",
          "patternProperties": {
            "^0x[0-9a-fA-F]{8}$": { "type": "string", "pattern": "^[0-9]+/hour$" }
          },
          "additionalProperties": false
        },
        "per_target_d1": {
          "type": "object",
          "patternProperties": {
            "^0x[0-9a-fA-F]{40}$": { "type": "number", "exclusiveMinimum": 0 }
          },
          "additionalProperties": false
        }
      }
    },
    "calls": {
      "type": "object",
      "required": ["allowlist"],
      "properties": {
        "allowlist": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "array",
            "prefixItems": [
              { "type": "integer", "minimum": 1 },
              { "type": "string", "pattern": "^0x[0-9a-fA-F]{40}$" },
              { "type": "string", "pattern": "^0x[0-9a-fA-F]{8}$" }
            ],
            "items": false,
            "minItems": 3,
            "maxItems": 3
          }
        },
        "denylist": {
          "type": "array",
          "items": {
            "type": "array",
            "prefixItems": [
              { "type": "integer", "minimum": 1 },
              { "type": "string", "pattern": "^0x[0-9a-fA-F]{40}$" },
              { "type": "string", "pattern": "^0x[0-9a-fA-F]{8}$" }
            ],
            "items": false,
            "minItems": 3,
            "maxItems": 3
          }
        }
      }
    },
    "approvals": {
      "type": "object",
      "required": ["quorum"],
      "properties": {
        "quorum": { "type": "integer", "minimum": 2 },
        "timelock_hours": { "type": "integer", "minimum": 0 },
        "policy_edit_timelock_hours": { "type": "integer", "minimum": 0 }
      }
    },
    "controls": {
      "type": "object",
      "properties": {
        "pause": { "type": "object", "properties": { "enabled": { "type": "boolean" } } }
      }
    },
    "intent_filters": {
      "type": "object",
      "properties": {
        "max_slippage_bps": { "type": "integer", "minimum": 0, "maximum": 10000 },
        "max_price_dev_bps": { "type": "integer", "minimum": 0, "maximum": 10000 }
      }
    }
  }
}
